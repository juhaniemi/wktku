<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" type="text/css" href="stylesheets/screen.css">
    <script src="js/instafeed.js" type="text/javascript"></script>

    <title>Turku Instafeed</title>

  </head>
  <body>
    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->
  
  <div id="page">
    <h1>Turku Instafeed</h1>
    <div id="instafeed"></div>
  </div>
  
  <script type="text/javascript">
    var apiBusy = true;
    var feed = new Instafeed({
      get: 'tagged',
      tagName: 'wktku',
      limit: 20,
      resolution: 'low_resolution',
      template: '<figure><a href="{{model.images.standard_resolution.url}}"><img src="{{image}}" /></a><figcaption><span class="caption">"{{caption}}"</span> <span class="likes">&#10084; {{likes}}</span></figcaption></figure>',
      clientId: '4d2075f6e2c645839da4089dc27e88b2',
      append: true,
      success: function() {
        apiBusy = false;
      }
    });
    feed.run();
    
    // Bind onscroll to load new images lazily
    window.onscroll = function() {
      if (!apiBusy) {
        // Get last image and its offset from top
        var container = document.getElementById('instafeed');
        var imgList = container.getElementsByTagName('figure');
        var lastImg = imgList[imgList.length-1];
        var lastImgOffset = lastImg.getBoundingClientRect().top;
        var scrollTop = document.body.offsetTop;
        var windowBottom = scrollTop + window.innerHeight;
        if (windowBottom > lastImgOffset) {
          apiBusy = true;
          feed.runNext();
        }
      }
    };
  </script>

  </body>
</html>
